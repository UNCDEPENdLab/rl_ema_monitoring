function load_epoch_TF_US(name)

sampling_rate = 256.03;
data_folder = '/Volumes/bierka_root/datamesh/PROC/MMTM/Momentum_EMA/Data_Processed_Nov_23/Momentum_EMA_EEG_12_2023/';
output_folder = '/Volumes/bierka_root/datamesh/PROC/MMTM/Momentum_EMA/';
%output_folder = '/bgfs/adombrovski/DNPL_DataMesh/Data/Momentum_EMA';  

%filename_EEG = dir(strcat(fullfile(data_folder,['subject_' name]),['\' name '_EEG1.mat']));
filename_EEG = dir(strcat(fullfile(data_folder,['subject_' name]),['/' name '_EEG1.mat'])); % testing on Mac
if  ~isempty(filename_EEG)
    
    if ~exist(fullfile(output_folder, 'Data_Processed','TF_Analysis',['subject_' name]),'dir')
        mkdir(fullfile(output_folder, 'Data_Processed','TF_Analysis',['subject_' name]))
    end
    
    % feedback
    load(strcat(filename_EEG(1).folder,'/',filename_EEG(1).name), 'epoch_data_feedback','gap_feedback','time_window')
    feedback_time = find(time_window==0);
    

    left_temp = epoch_data_feedback(:,:,1);
    times = time_window;
    [TF_left_temp,freqs] = EEGtimefreq_US(left_temp, sampling_rate);
    TF_left_temp = squeeze(TF_left_temp(:,:,find(times < -1000,1,'last'):find(times > -2500,1,'first'));
    save(fullfile(output_folder, 'Data_Processed','TF_Analysis',['subject_' name] ,[name '_feedback_TF_left_temp']), 'TF_left_temp','sampling_rate','feedback_time','freqs','times', '-v7.3');
    clear TF_left_temp left_temp

%     left_front = epoch_data_feedback(1:8705,:,2);
%     TF_left_front = EEGtimefreq_US(left_front, sampling_rate, feedback_time);
%     times = time_window;
%     TF_left_front = squeeze(TF_left_front);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_feedback_TF_left_front']), 'TF_left_front','sampling_rate','feedback_time','freqs','times', '-v7.3')
%     clear TF_left_front left_front
% 
%     right_front = epoch_data_feedback(1:8705,:,3);
%     TF_right_front = EEGtimefreq_US(right_front, sampling_rate, feedback_time);
%     times = time_window;
%     TF_right_front = squeeze(TF_right_front);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_feedback_TF_right_front']), 'TF_right_front','sampling_rate','feedback_time','freqs','times', '-v7.3')
%     clear TF_right_front right_front
% 
%     right_temp = epoch_data_feedback(1:8705,:,4);
%     TF_right_temp = EEGtimefreq_US(right_temp, sampling_rate, feedback_time);
%     times = time_window;
%     TF_right_temp = squeeze(TF_right_temp);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_feedback_TF_right_temp']), 'TF_right_temp','sampling_rate','feedback_time','freqs','times', '-v7.3')
%     clear TF_right_temp right_temp
%     
%     clear epoch_data_feedback
%     
%     % choice
%     load(strcat(filename_EEG(1).folder,'/',filename_EEG(1).name), 'epoch_data_choice_filtered','gap_choice_filtered')
%     choice_time = (size(epoch_data_choice_filtered,2)-1)/2; % assuming a centered window
%     
%     left_temp = epoch_data_choice(1:8705,:,1);
%     TF_left_temp = EEGtimefreq_US(left_temp, sampling_rate, choice_time);
%     times = time_window;
%     TF_left_temp = squeeze(TF_left_temp);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_choice_TF_left_temp']), 'TF_left_temp','sampling_rate','choice_time','freqs','times', '-v7.3');
%     clear TF_left_temp left_temp
%     
%     left_front = epoch_data_choice(1:8705,:,2);
%     TF_left_front = EEGtimefreq_US(left_front, sampling_rate, choice_time);
%     times = time_window;
%     TF_left_front = squeeze(TF_left_front);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_choice_TF_left_front']), 'TF_left_front','sampling_rate','choice_time','freqs','times', '-v7.3')
%     clear TF_left_front left_front
%     
%     
%     right_front = epoch_data_choice(1:8705,:,3);
%     TF_right_front = EEGtimefreq_US(right_front, sampling_rate, choice_time);
%     times = time_window;
%     TF_right_front = squeeze(TF_right_front);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_choice_TF_right_front']), 'TF_right_front','sampling_rate','choice_time','freqs','times', '-v7.3')
%     clear TF_right_front right_front
% 
%     right_temp = epoch_data_choice(1:8705,:,4);
%     TF_right_temp = EEGtimefreq_US(right_temp, sampling_rate, choice_time);
%     times = time_window;
%     TF_right_temp = squeeze(TF_right_temp);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_choice_TF_right_temp']), 'TF_right_temp','sampling_rate','choice_time','freqs','times', '-v7.3')
%     clear TF_right_temp right_temp
%     
%     clear epoch_data_choice
%     
%     % stim
%     load(strcat(filename_EEG(1).folder,'/',filename_EEG(1).name), 'epoch_data_stim_filtered','gap_stim_filtered')
%     stim_time = (size(epoch_data_stim_filtered,2)-1)/2; % assuming a centered window
%     
%     left_temp = epoch_data_stim(1:8705,:,1);
%     TF_left_temp = EEGtimefreq_US(left_temp, sampling_rate, stim_time);
%     times = time_window;
%     TF_left_temp = squeeze(TF_left_temp);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_stim_TF_left_temp']), 'TF_left_temp','sampling_rate','choice_time','freqs','times', '-v7.3');
%     clear TF_left_temp left_temp
%     
%     left_front = epoch_data_stim(1:8705,:,2);
%     TF_left_front = EEGtimefreq_US(left_front, sampling_rate, stim_time);
%     times = time_window;
%     TF_left_front = squeeze(TF_left_front);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_stim_TF_left_front']), 'TF_left_front','sampling_rate','stim_time','freqs','times', '-v7.3')
%     clear TF_left_front left_front
%     
%     right_front = epoch_data_stim(1:8705,:,3);
%     TF_right_front = EEGtimefreq_US(right_front, sampling_rate, stim_time);
%     times = time_window;
%     TF_right_front = squeeze(TF_right_front);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_stim_TF_right_front']), 'TF_right_front','sampling_rate','stim_time','freqs','times', '-v7.3')
%     clear TF_right_front right_front
%     
%     right_temp = epoch_data_stim_filtered(1:8705,:,4);
%     TF_right_temp = EEGtimefreq_US(right_temp, sampling_rate, stim_time);
%     times = time_window;
%     TF_right_temp = squeeze(TF_right_temp);
%     save(fullfile(output_folder, 'Data_Processed',['subject_' name] ,[name '_stim_TF_right_temp']), 'TF_right_temp','sampling_rate','stim_time','freqs','times', '-v7.3')
%     clear TF_right_temp right_temp
%     
%     clear epoch_data_stim
    
    
end
end





