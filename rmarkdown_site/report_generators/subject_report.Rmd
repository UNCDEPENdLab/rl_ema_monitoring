---
title: Subject `r params$id` RL-EMA report
output:
  html_document:
    toc: yes
    toc_depth: 1
    toc_float: true
    css: "../dashboard.css"
    self_contained: false
    lib_dir: "site_libs"
params:
  id: "221604"
  data_dir: "/Users/hallquist/Downloads/data"
  output_dir: "/Users/hallquist/Data_Analysis/Momentum/rl_ema_monitoring/rmarkdown_site/rendered_site"
  render_debug: FALSE
---

Generated on `r format(Sys.time(), "%a %b %d, %Y %I:%M %p")`

```{r setup, echo=FALSE, warning=FALSE, message=FALSE, results="asis"}
knitr::opts_chunk$set(echo = TRUE)
library(pacman)
pacman::p_load(REDCapR, dplyr, tidyr, ggplot2, cowplot, rjson, reactable, reactablefmtr, checkmate, htmltools)

# Suppress summarise messages about grouping
options(dplyr.summarise.inform = FALSE)
source("../report_functions/report_functions.R")

id <- params$id
data_dir <- params$data_dir
output_dir <- params$output_dir
render_debug <- params$render_debug

#subject-specific plot directory
p_base <- file.path(data_dir, "Subjects", id, "plots")
if (!dir.exists(p_base)) {
  dashboard_warning("Cannot find subject plot directory:", p_base)
}

d_base <- file.path(data_dir, "Subjects", id)
if (!dir.exists(d_base)) {
  dashboard_error("Cannot find subject data directory:", d_base)
} 

```

<!--
Note: When the top-level headers for each section were in the respective report_generators,
I tried using top-level blank sections below to force the close of .tabset tabs
in cases where the rendering fails. Otherwise, the error messages will get
folded into the preceding tabset and be hard for the user to see. These blank
sections are not added to the TOC and should not have any negative effects.
# {.unlisted .unnumbered .toc-ignore}
https://stackoverflow.com/questions/38062706/rmarkdown-how-to-end-tabbed-content
I have now moved to including the top-level headers inline in the Rmd so that these are always
rendered prior to any knitting of the child report
-->

# Overview report is pending
```{r overview-report, echo=FALSE, results='asis', eval=FALSE}
render_child("overview_report.Rmd", "Subject overview")
```

# Task compliance {.tabset}
```{r compliance-report, echo=FALSE, results='asis', eval=TRUE}
render_child("task_compliance_report.Rmd", "Task compliance")
```

# EEG signal quality {.tabset}
```{r eeg-report, echo=FALSE, results='asis'}
render_child("eeg_report.Rmd", "EEG signal quality")
```

# Sleep diary {.tabset}
```{r sleep-report, echo=FALSE, results='asis'}
render_child("sleep_report.Rmd", "Sleep diary")
```

# Heart rate {.tabset}
```{r hr-report, echo=FALSE, results='asis'}
render_child("hr_report.Rmd", "Heart rate")
```

# Task performance {.tabset}
```{r task-performance-report, echo=FALSE, results='asis'}
render_child("task_performance_report.Rmd", "Task performance")
```

# Mood questionnaire {.tabset}
```{r mood-report, echo=FALSE, results='asis'}
render_child("mood_report.Rmd", "Mood")
```
