```{r task-performance-data, include=FALSE}
source("task_performance_report_functions.R")
task_performance_data <- get_task_performance_data(id, data_dir)
```

\newline
### Task performance {.tabset}
#### Unchecked

```{r task-performance-unchecked-table, echo=FALSE, warning=FALSE, results="asis"}
#task performance table
render_task_performance_table(task_performance_data, "unchecked")
```

#### All blocks
```{r task-performance-all-table, echo=FALSE, warning=FALSE, results="asis"}
render_task_performance_table(task_performance_data, "all")
```

#### Accuracy by block
```{r task-exp, echo=FALSE, warning=FALSE, results="asis"}
p_base <- file.path(data_dir, "Subjects", id, "plots")
exp_graph <- file.path(p_base, "acc_from_exp_prob.png")
des_graph <- file.path(p_base, "acc_from_des_prob.png")

g1 <- g2 <- NULL
if (file.exists(exp_graph)) {
  #knitr::include_graphics(exp_graph)
  g1 <- ggdraw() + draw_image(exp_graph)
} else {
  dashboard_warning("No experienced probabilities graph at: ", exp_graph)
}

if (file.exists(des_graph)) {
  #knitr::include_graphics(c(exp_graph, des_graph))
  g2 <- ggdraw() + draw_image(des_graph)
} else {
  dashboard_warning("No designated probabilities graph at: ", des_graph)
}

if (is.ggplot(g1) && is.ggplot(g2)) {
  cowplot::plot_grid(g1, g2, nrow=1) #, rel_widths = c(0.5, 0.5), align="hv", greedy = FALSE)
} else if (is.ggplot(g1)) {
  plot(g1)
} else if (is.ggplot(g2)) {
  plot(g2)
}

```


#### Learning curve
```{r task-lr, echo=FALSE, warning=FALSE, results="asis"}
p_base <- file.path(data_dir, "Subjects", id, "plots")
lr_graph <- file.path(p_base, "lr_plot.png")
if (file.exists(lr_graph)) {
  knitr::include_graphics(lr_graph)
} else {
  dashboard_warning("No learning curve graph at: ", lr_graph)
}
```


#### Reaction times
```{r task-rt, echo=FALSE, warning=FALSE, results="asis"}
p_base <- file.path(data_dir, "Subjects", id, "plots")
rt_graph <- file.path(p_base, "rt_graph.png")
if (file.exists(rt_graph)) {
  knitr::include_graphics(rt_graph)
} else {
  dashboard_warning("No reaction time graph at: ", rt_graph)
}
```

#### Side bias
```{r task-bias, echo=FALSE, warning=FALSE, results="asis"}
p_base <- file.path(data_dir, "Subjects", id, "plots")
sb_graph <- file.path(p_base, "sb_graph.png")
if (file.exists(sb_graph)) {
  knitr::include_graphics(sb_graph)
} else {
  dashboard_warning("No side bias graph at: ", sb_graph)
}
```